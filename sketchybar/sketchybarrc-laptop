PLUGIN_DIR="$HOME/.config/sketchybar/plugins-laptop"
FONT_FACE="Hack Nerd Font"

##### Bar Appearance #####
# https://felixkratz.github.io/SketchyBar/config/bar

bar=(
    height=36
    blur_radius=30
    position=top
    sticky=on
    padding_left=20
    padding_right=20
    color=0x6624273a
)
sketchybar --bar "${bar[@]}"

default=(
    updates=when_shown
    # background.color=0xff24273a
    background.padding_left=2
    background.padding_right=2
    background.corner_radius=5
    background.height=24
    icon.color=0xffffffff
    icon.font="$FONT_FACE:Bold:17.0"
    icon.padding_left=8
    icon.padding_right=7
    label.font="$FONT_FACE:Bold:12.0"
    label.color=0xffcad3f5
    label.padding_left=0
    label.padding_right=7
)
sketchybar --default "${default[@]}"

# INFO: left-side bar components
# INFO: add space config at maximum for 10 spaces
for i in {0..9};
do
    sid=$(($i+1))
    space=(
        associated_space=$sid
        icon=$sid
        icon.font="$FONT_FACE:Bold:13.0"
        background.color=0xff24273a
        background.corner_radius=5
        background.padding_right=5
        background.drawing=off
        label.drawing=off
        script="$PLUGIN_DIR/current_space.sh"
        click_script="yabai -m space --focus $sid"
    )
    sketchybar --add space space.$sid left  \
               --set space.$sid "${space[@]}"
done

front_app=(
    background.color=0xffa6da95
    background.padding_left=0
    background.padding_right=0
    icon.y_offset=1
    icon.color=0xff24273a
    label.drawing=no
    script="$PLUGIN_DIR/front_app.sh"
)
front_app_name=(
    icon.drawing=off
    label.drawing=yes
    background.padding_right=8
)
sketchybar --add item front_app left                    \
           --set front_app "${front_app[@]}"            \
                                                        \
           --add item front_app.name left               \
           --set front_app.name "${front_app_name[@]}"  \
                                                        \
           --add bracket front_app_bracket              \
                 front_app front_app.name               \
           --subscribe front_app front_app_switched

# INFO: center bar components
weather=(
    background.padding_right=4
    icon=
    icon.y_offset=1
    icon.color=0xfff5bde6
    icon.font="$FONT_FACE:Bold:16.0"
    update_freq=1800
    script="$PLUGIN_DIR/weather.sh"
)
SPOTIFY_EVENT="com.spotify.client.PlaybackStateChanged"
spotify=(
    background.padding_left=2
    icon=
    icon.font="$FONT_FACE:Bold:20.0"
    label.drawing=off
    label.padding_left=3
    script="$PLUGIN_DIR/spotify.sh"
)
sketchybar --add item weather center                         \
           --set weather "${weather[@]}"                     \
           --subscribe weather system_woke                   \
                                                             \
           --add event spotify_change $SPOTIFY_EVENT         \
           --add item spotify center                         \
           --set spotify "${spotify[@]}"                     \
           --subscribe spotify mouse.clicked spotify_change

# INFO: right-side bar components
clock=(
    icon=
    icon.y_offset=1
    icon.color=0xffed8796
    update_freq=10
    script="$PLUGIN_DIR/clock.sh"
)
battery=(
    icon.y_offset=1
    update_freq=120
    script="$PLUGIN_DIR/battery.sh"
)
wifi=(
    icon.y_offset=1
    script="$PLUGIN_DIR/wifi.sh"
)
KEYBOARD_EVENT="AppleSelectedInputSourcesChangedNotification"
keyboard=(
    icon=󰧹
    icon.y_offset=1
    script="$PLUGIN_DIR/keyboard.sh"
)
sketchybar  --add item clock right                              \
            --set clock "${clock[@]}"                           \
                                                                \
            --add item battery right                            \
            --set battery "${battery[@]}"                       \
            --subscribe battery system_woke power_source_change \
                                                                \
            --add item wifi right                               \
            --set wifi "${wifi[@]}"                             \
            --subscribe wifi wifi_change                        \
                                                                \
            --add event input_change $KEYBOARD_EVENT            \
            --add item keyboard right                           \
            --set keyboard "${keyboard[@]}"                     \
            --subscribe keyboard input_change


##### Finalizing Setup #####
sketchybar --update
